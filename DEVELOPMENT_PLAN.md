# YouTube Playlist Generator - Complete Development Plan

## Executive Summary
This document outlines the complete development plan for a personal YouTube playlist generator that:
- Receives video lists via Telegram bot or web UI
- Uses AI (OpenAI) to generate creative playlist metadata
- Automatically creates YouTube playlists via YouTube API
- Provides a simple web interface using Magic UI MCP
- Deploys on a Hostinger VPS

### Current Progress
- ✅ **Phase 1 Complete**: Core Functionality
  - Project structure created
  - Core playlist logic implemented (video extraction, validation)
  - Configuration management setup
  - OpenAI integration for title generation
  - OAuth2 implementation for actual playlist creation
  - Successfully creating real YouTube playlists
- ✅ **Phase 2 Complete**: Bot Development
  - Telegram bot implemented with all commands
  - FastAPI backend with all endpoints
  - SQLite database integration with history tracking
  - API tests and database tests passing
- ⏳ **Phase 3 Next**: Frontend and Deployment
  - Web UI with Magic UI MCP pending
  - VPS deployment configuration pending

## Table of Contents
1. [Project Architecture](#project-architecture)
2. [Technical Stack](#technical-stack)
3. [Implementation Phases](#implementation-phases) ⏳ In Progress
4. [Detailed Component Specifications](#detailed-component-specifications)
5. [API Documentation](#api-documentation)
6. [Deployment Strategy](#deployment-strategy)
7. [Testing Plan](#testing-plan)
8. [Security Considerations](#security-considerations)
9. [Future Enhancements](#future-enhancements)

## Project Architecture

### System Overview
```
┌─────────────────┐     ┌─────────────────┐
│  Telegram Bot   │     │   Web UI (MCP)  │
└────────┬────────┘     └────────┬────────┘
         │                       │
         ▼                       ▼
┌─────────────────────────────────────────┐
│          FastAPI Backend                 │
│  ┌────────────┐  ┌─────────────────┐   │
│  │ Endpoints  │  │ Playlist Core   │   │
│  └────────────┘  └─────────────────┘   │
└─────────────────────────────────────────┘
         │              │              │
         ▼              ▼              ▼
┌──────────────┐ ┌─────────────┐ ┌────────┐
│ YouTube API  │ │ OpenAI API  │ │ SQLite │
└──────────────┘ └─────────────┘ └────────┘
```

### Directory Structure
```
youtube-playlist-bot/
├── src/
│   ├── __init__.py            ✅
│   ├── bot.py                 # Telegram bot implementation
│   ├── api.py                 # FastAPI web server
│   ├── playlist_core.py       ✅ Core playlist logic
│   ├── config.py              ✅ Configuration management
│   ├── youtube_auth.py        ✅ OAuth2 authentication
│   ├── models.py              # Pydantic models
│   ├── database.py            # SQLite database interface
│   └── utils.py               # Utility functions
├── tests/
│   ├── __init__.py            ✅
│   ├── test_playlist_core.py
│   ├── test_api.py
│   └── test_bot.py
├── deployment/
│   ├── services/              ✅
│   │   ├── telegram-bot.service
│   │   └── playlist-api.service
│   ├── nginx/                 ✅
│   │   └── youtube-playlist.conf
│   └── deploy.sh
├── frontend/                  # Generated by Magic UI MCP
├── requirements.txt           ✅
├── requirements-dev.txt
├── .env.example               ✅
├── .gitignore                 ✅
├── README.md                  ✅
├── DEVELOPMENT_PLAN.md        ✅ This file
├── test_playlist.py           ✅ CLI test script
├── test_playlist_oauth.py     ✅ OAuth test script
├── setup_oauth.py             ✅ OAuth setup script
├── credentials.json           ✅ OAuth credentials (generated)
├── token.pickle               ✅ OAuth token (generated)
└── docker-compose.yml         # Optional for local development
```

## Technical Stack

### Backend Technologies
- **Python 3.11+**: Primary language
- **FastAPI**: REST API framework with automatic OpenAPI documentation
- **python-telegram-bot**: Telegram bot framework
- **google-api-python-client**: YouTube Data API v3 integration
- **OpenAI Python SDK**: For AI-generated playlist titles
- **SQLite**: Lightweight database for playlist history
- **Pydantic**: Data validation and settings management
- **python-dotenv**: Environment variable management

### Frontend Technologies
- **Magic UI MCP**: Component-based UI framework
- **Tailwind CSS**: Styling (if supported by MCP)
- **Vanilla JavaScript**: For API interactions

### Infrastructure
- **Hostinger VPS**: Ubuntu 22.04 LTS
- **Nginx**: Reverse proxy and static file serving
- **systemd**: Service management
- **Let's Encrypt**: SSL certificates
- **GitHub**: Version control

## Implementation Phases

### Phase 1: Core Functionality (Week 1) ✅ COMPLETED
1. **Day 1-2**: Setup and Core Logic
   - ✅ Initialize project structure
   - ✅ Implement `playlist_core.py` with basic YouTube integration
   - ✅ Create configuration management
   - ⏳ Write unit tests for core functions

2. **Day 3-4**: YouTube API Integration
   - ✅ Implement OAuth2 flow for YouTube
   - ✅ Create playlist creation functions (fully working)
   - ✅ Add video validation and error handling
   - ✅ Test with various YouTube URL formats

3. **Day 5-7**: AI Integration
   - ✅ Integrate OpenAI API for title generation
   - ✅ Create prompt engineering for optimal titles
   - ✅ Add fallback logic for API failures
   - ✅ Test title generation with various video sets

### Phase 2: Bot Development (Week 2) ✅ COMPLETED
1. **Day 8-9**: Telegram Bot
   - ✅ Create bot with BotFather (needs actual token)
   - ✅ Implement command handlers
   - ✅ Add user authentication (ID whitelist)
   - ⏳ Test bot interactions (waiting for valid token)

2. **Day 10-11**: FastAPI Backend
   - ✅ Create REST API endpoints
   - ✅ Implement request/response models
   - ✅ Add CORS configuration
   - ✅ Write API tests

3. **Day 12-14**: Database Integration
   - ✅ Design SQLite schema
   - ✅ Implement database models
   - ✅ Add history tracking
   - ✅ Create database migrations (auto-init)

### Phase 3: Frontend and Deployment (Week 3) ⏳ IN PROGRESS
1. **Day 15-16**: Frontend Development
   - ✅ Create Magic UI MCP interface
   - ✅ Implement API integration  
   - ✅ Add responsive design
   - ✅ Test cross-browser compatibility

2. **Day 17-18**: VPS Setup
   - Configure Hostinger VPS
   - Install dependencies
   - Setup Nginx reverse proxy
   - Configure SSL certificates

3. **Day 19-21**: Deployment and Testing
   - Deploy services with systemd
   - Configure monitoring
   - Perform end-to-end testing
   - Create documentation

## Detailed Component Specifications

### 1. Configuration Management (config.py)
```python
from pydantic_settings import BaseSettings
from typing import Optional

class Settings(BaseSettings):
    # API Keys
    telegram_token: str
    youtube_api_key: str
    openai_api_key: str
    
    # YouTube OAuth
    youtube_client_id: str
    youtube_client_secret: str
    youtube_redirect_uri: str = "http://localhost:8080"
    
    # API Settings
    api_host: str = "0.0.0.0"
    api_port: int = 8000
    allowed_origins: list[str] = ["http://localhost:3000"]
    
    # Telegram Settings
    allowed_telegram_users: list[int] = []
    
    # Feature Settings
    max_videos_per_playlist: int = 50
    default_playlist_privacy: str = "unlisted"
    enable_ai_titles: bool = True
    
    # Database
    database_url: str = "sqlite:///playlists.db"
    
    class Config:
        env_file = ".env"
```

### 2. Core Playlist Logic (playlist_core.py) ✅
Key functions implemented:

```python
class PlaylistGenerator:
    def __init__(self, youtube_service, openai_client):  ✅
        self.youtube = youtube_service
        self.openai = openai_client
    
    async def create_playlist(  ✅
        self,
        video_urls: List[str],
        custom_title: Optional[str] = None,
        description: Optional[str] = None
    ) -> PlaylistResult:
        """Main function to create a playlist"""
        
    def extract_video_ids(self, urls: List[str]) -> List[str]:  ✅
        """Extract video IDs from various YouTube URL formats"""
        
    def validate_videos(self, video_ids: List[str]) -> VideoValidationResult:  ✅
        """Check if videos exist and are accessible"""
        
    async def generate_title(self, video_details: List[VideoInfo]) -> str:  ✅
        """Use AI to generate a creative playlist title"""
        
    def create_youtube_playlist(  ✅ Implemented with OAuth2
        self,
        title: str,
        description: str,
        privacy: str = "unlisted"
    ) -> str:
        """Create playlist on YouTube and return ID"""
        
    def add_videos_to_playlist(  ✅ Implemented with OAuth2
        self,
        playlist_id: str,
        video_ids: List[str]
    ) -> AddVideosResult:
        """Add videos to the created playlist"""
```

### 3. Database Schema (database.py)
```sql
-- Playlists table
CREATE TABLE playlists (
    id TEXT PRIMARY KEY,
    youtube_id TEXT UNIQUE NOT NULL,
    title TEXT NOT NULL,
    description TEXT,
    url TEXT NOT NULL,
    video_count INTEGER NOT NULL,
    created_by TEXT NOT NULL, -- 'telegram' or 'web'
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    user_identifier TEXT -- telegram_id or ip_address
);

-- Videos table (for tracking which videos were in each playlist)
CREATE TABLE playlist_videos (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    playlist_id TEXT NOT NULL,
    video_id TEXT NOT NULL,
    video_title TEXT,
    video_channel TEXT,
    position INTEGER NOT NULL,
    added_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (playlist_id) REFERENCES playlists(id)
);

-- API usage tracking
CREATE TABLE api_usage (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    service TEXT NOT NULL, -- 'youtube' or 'openai'
    operation TEXT NOT NULL,
    tokens_used INTEGER,
    cost_estimate REAL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 4. Telegram Bot Commands (bot.py)
```python
Commands:
/start - Welcome message with instructions
/help - Detailed usage guide
/stats - Show user statistics
/history - Show last 5 playlists created
/cancel - Cancel current operation

Message handling:
- Any message with YouTube URLs triggers playlist creation
- Support for multiple URL formats:
  - https://www.youtube.com/watch?v=VIDEO_ID
  - https://youtu.be/VIDEO_ID
  - https://youtube.com/shorts/VIDEO_ID
  - https://m.youtube.com/watch?v=VIDEO_ID
```

### 5. API Endpoints (api.py)
```python
# Playlist Management
POST   /api/v1/playlists           # Create new playlist
GET    /api/v1/playlists           # List playlists (paginated)
GET    /api/v1/playlists/{id}      # Get specific playlist
DELETE /api/v1/playlists/{id}      # Delete playlist (from history only)

# Video Validation
POST   /api/v1/videos/validate     # Validate video URLs before creation

# Statistics
GET    /api/v1/stats               # Get usage statistics
GET    /api/v1/stats/daily         # Daily breakdown

# Health & Info
GET    /api/health                 # Health check
GET    /api/version                # API version info
```

## API Documentation

### Create Playlist Endpoint
```
POST /api/v1/playlists
Content-Type: application/json

Request:
{
    "videos": [
        "https://www.youtube.com/watch?v=dQw4w9WgXcQ",
        "https://youtu.be/9bZkp7q19f0"
    ],
    "title": "My Awesome Playlist",  // Optional
    "description": "A collection of great videos",  // Optional
    "privacy": "unlisted"  // Options: public, unlisted, private
}

Response (200 OK):
{
    "success": true,
    "data": {
        "playlist_id": "PLrAXtmErZgOeiKm4sgNOknGvNjby9efdf",
        "playlist_url": "https://www.youtube.com/playlist?list=PLrAXtmErZgOeiKm4sgNOknGvNjby9efdf",
        "title": "AI Generated: Best Music Hits Collection",
        "video_count": 2,
        "videos_added": [
            {
                "video_id": "dQw4w9WgXcQ",
                "title": "Rick Astley - Never Gonna Give You Up",
                "status": "added"
            }
        ],
        "videos_skipped": [
            {
                "video_id": "invalid123",
                "reason": "Video not found"
            }
        ]
    }
}

Response (400 Bad Request):
{
    "success": false,
    "error": {
        "code": "INVALID_URLS",
        "message": "No valid YouTube URLs found in request"
    }
}
```

### Error Codes
- `INVALID_URLS`: No valid YouTube URLs provided
- `YOUTUBE_AUTH_ERROR`: YouTube authentication failed
- `QUOTA_EXCEEDED`: YouTube API quota exceeded
- `AI_SERVICE_ERROR`: OpenAI service unavailable
- `MAX_VIDEOS_EXCEEDED`: Too many videos (>50)
- `PLAYLIST_CREATION_FAILED`: Failed to create playlist

## Deployment Strategy

### 1. VPS Initial Setup
```bash
# Update system
sudo apt update && sudo apt upgrade -y

# Install dependencies
sudo apt install python3.11 python3.11-venv python3-pip nginx certbot python3-certbot-nginx git sqlite3 -y

# Create application user
sudo useradd -m -s /bin/bash playlist-bot
sudo usermod -aG www-data playlist-bot

# Clone repository
sudo -u playlist-bot git clone https://github.com/yourusername/youtube-playlist-bot.git /home/playlist-bot/app
```

### 2. Python Environment Setup
```bash
# Create virtual environment
cd /home/playlist-bot/app
sudo -u playlist-bot python3.11 -m venv venv

# Install dependencies
sudo -u playlist-bot ./venv/bin/pip install -r requirements.txt

# Copy and configure .env
sudo -u playlist-bot cp .env.example .env
# Edit .env with actual values
```

### 3. Systemd Service Configuration
Create services for both bot and API with automatic restart on failure.

### 4. Nginx Configuration
- Configure reverse proxy for API
- Serve static files for frontend
- Enable SSL with Let's Encrypt
- Add rate limiting for API endpoints

### 5. Monitoring Setup
- Configure systemd journal logging
- Set up log rotation
- Optional: Add Prometheus metrics endpoint
- Create health check monitoring

## Testing Plan

### Unit Tests
1. **Core Functions**
   - Video ID extraction from various URL formats
   - Playlist title generation
   - Error handling for API failures

2. **API Tests**
   - Endpoint validation
   - Error response formats
   - Rate limiting behavior

3. **Bot Tests**
   - Command handling
   - User authentication
   - Message parsing

### Integration Tests
1. **YouTube API Integration**
   - OAuth flow
   - Playlist creation
   - Video validation

2. **OpenAI Integration**
   - Title generation
   - Fallback behavior

3. **Database Operations**
   - CRUD operations
   - Transaction handling

### End-to-End Tests
1. **Telegram Bot Flow**
   - Send URLs → Receive playlist link
   - Error scenarios

2. **Web UI Flow**
   - Submit form → Create playlist
   - View history

### Performance Tests
- Concurrent request handling
- Large video list processing (50 videos)
- Database query optimization

## Security Considerations

### Authentication & Authorization
1. **Telegram Bot**
   - Whitelist specific Telegram user IDs
   - Validate all input messages
   - Rate limit per user

2. **Web API**
   - API key authentication for future expansion
   - CORS configuration
   - Request validation with Pydantic

### Data Security
1. **Sensitive Data**
   - Store API keys in environment variables
   - Never log sensitive information
   - Encrypt OAuth tokens at rest

2. **Input Validation**
   - Sanitize all user inputs
   - Validate YouTube URLs strictly
   - Limit request sizes

### Infrastructure Security
1. **VPS Hardening**
   - Configure firewall (ufw)
   - Disable root SSH login
   - Use SSH keys only
   - Regular security updates

2. **Application Security**
   - Run services as non-root user
   - Use principle of least privilege
   - Monitor for suspicious activity

## Future Enhancements

### Phase 4: Advanced Features (Future)
1. **Playlist Management**
   - Edit existing playlists
   - Merge multiple playlists
   - Duplicate playlist detection

2. **Enhanced AI Features**
   - Custom AI prompts for titles
   - Playlist description generation
   - Video order optimization

3. **User Features**
   - Multiple user support
   - User preferences
   - Playlist templates

4. **Analytics**
   - Usage statistics dashboard
   - Cost tracking for API usage
   - Performance metrics

### Phase 5: Scaling (If Needed)
1. **Performance Optimization**
   - Redis caching
   - Background job queue (Celery)
   - PostgreSQL migration

2. **Multi-tenant Support**
   - User authentication system
   - Per-user quotas
   - Billing integration

## Development Best Practices

### Code Quality
- Use type hints throughout
- Follow PEP 8 style guide
- Write comprehensive docstrings
- Maintain >80% test coverage

### Version Control
- Use semantic versioning
- Create feature branches
- Write descriptive commit messages
- Tag releases

### Documentation
- Keep README up to date
- Document all API endpoints
- Include setup troubleshooting
- Create user guide

### Monitoring & Maintenance
- Monitor API quotas daily
- Check logs for errors
- Update dependencies monthly
- Backup database weekly

## Conclusion
This plan provides a comprehensive roadmap for building a robust YouTube playlist generator. The phased approach allows for iterative development and testing, ensuring a stable and user-friendly final product. The focus on simplicity and reliability makes this perfect for personal use while maintaining professional code quality.